# ğŸ„ Advent of Code Badges workflow ğŸ„ 
# ====================================
# Author: joblo2213
# License: MIT License (https://choosealicense.com/licenses/mit/) 
#
# This workflow updates the badges of your README.md after every push to the repository. 
# The day badge is updated based on the number of files in your repository.
# The stars badge increases it's value whenever u use a Star (â­) in your commit message.
# Add two  stars to a commit message to increase it by two stars.
# If you for some reason mess it up you have to manually adjust the values in your readme file.
#
# 
#
# Make sure to add the following badges to your README.md:
# ![Days completed](https://img.shields.io/badge/day%20ğŸ“…-0-blue)
# ![Stars](https://img.shields.io/badge/Stars%20â­-0-yellow)
# If you cahnge the color or the label of the badge you must also update the regexes used by the workflow.

name: ğŸ„ Advent of Code Badges ğŸ„
on: push
jobs:
  build:
    name: â­ Update badges ğŸ“…
    runs-on: ubuntu-latest
    if: startsWith(github.repository, 'joblo2213') && !contains(github.event.head_commit.message, 'Update badges')
    steps:
      - uses: actions/checkout@v2
        with:
          ssh-key: ${{ secrets.SSH_KEY }}
        
      - name: ğŸ“… Update day badge
        id: day
        # Make sure to update the path and the folder name regex so it works with your file structure.
        run: |
          day=$(find src/de/ungefroren/adventofcode/y2020 -maxdepth 1 -name "day*" | wc -l)
          echo "Day: $day"
          sed -i 's/day%20ğŸ“…-[0-9]\+-blue/day%20ğŸ“…-'"${day}"'-blue/' README.md
          
      - name: â­ Update stars badge
        id: star
        run: |
          commit_message="${{ github.event.head_commit.message }}"
          star="â­"
          oldstars=$(cat README.md | grep -o --perl-regexp '(?<=Stars%20â­-)[0-9]+(?=-yellow)')
          newstars=$(echo "${commit_message}" | awk -F "${star}" '{print NF-1}')
          stars=$((oldstars + newstars))
          echo "Old Stars: $oldstars"
          echo "Added Stars: $newstars"
          echo "Stars: $stars"
          sed -i 's/Stars%20â­-[0-9]\+-yellow/Stars%20â­-'"${stars}"'-yellow/' README.md
          
      - name: ğŸ“¤ Push
        run: |
          git config --global user.email "<>"
          git config --global user.name "Actions"
          git add .
          git diff-index --quiet HEAD || git commit --message "Update badges"
          git push origin master
